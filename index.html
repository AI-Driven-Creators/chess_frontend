<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自走棋模擬器 - Auto Chess Simulator</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #1a1a1a;
        }
        @font-face {
            font-family: 'Noto Sans TC';
            src: url('NotoSansTC-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        #application-canvas {
            width: 100%;
            height: 100vh;
        }
        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1a1a1a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
        }
        #loading-bar {
            width: 300px;
            height: 20px;
            background-color: #333;
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
        }
        #loading-bar-progress {
            width: 0%;
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <h1>自走棋模擬器</h1>
        <p>Loading...</p>
        <div id="loading-bar">
            <div id="loading-bar-progress"></div>
        </div>
    </div>
    <canvas id="application-canvas"></canvas>

    <!-- PlayCanvas Engine -->
    <script src="https://code.playcanvas.com/playcanvas-stable.min.js"></script>
    
    <!-- Main App Script - This is the only script we need to include directly -->
    <script type="module" src="dist/app.js"></script>

    <script type="module">
        // Initialize PlayCanvas application
        document.addEventListener('DOMContentLoaded', function() {
            // Create the application
            const canvas = document.getElementById('application-canvas');
            const app = new pc.Application(canvas);
            
            // Set canvas to fill window
            app.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW);
            app.setCanvasResolution(pc.RESOLUTION_AUTO);
            
            // Ensure canvas is resized when window changes size
            window.addEventListener('resize', function() {
                app.resizeCanvas();
            });
            
            // Set background color to dark gray
            app.scene.ambientLight = new pc.Color(0.5, 0.5, 0.5);
            
            // Create camera entity
            const camera = new pc.Entity('Camera');
            camera.addComponent('camera', {
                clearColor: new pc.Color(0.1, 0.1, 0.1)
            });
            camera.setPosition(0, 0, 10);
            app.root.addChild(camera);
            
            // Create light entity
            const light = new pc.Entity('Light');
            light.addComponent('light', {
                type: 'directional',
                color: new pc.Color(1, 1, 1),
                castShadows: true,
                intensity: 1.5
            });
            light.setEulerAngles(45, 0, 0);
            app.root.addChild(light);

            // Load Font
            const fntUrl = 'assets/fonts/chinese.json';
            app.assets.loadFromUrl(fntUrl, 'font', (err, fontAsset) => {
                if (err) {
                    console.error('Failed to load chinese.json', err);
                    return;
                }
                // Create UI root entity
            const uiRoot = new pc.Entity('UI Root');
            uiRoot.addComponent('screen', {
                referenceResolution: new pc.Vec2(1920, 1080),
                screenSpace: true
            });
            app.root.addChild(uiRoot);
            
            // Create UI containers
            // Create UI containers with visible borders and labels
            const shopContainer = new pc.Entity('Shop Container');
            shopContainer.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(0.5, 0, 0.5, 0),
                pivot: new pc.Vec2(0.5, 0),
                width: 800,
                height: 150,
                margin: new pc.Vec4(0, 10, 0, 10),
                color: new pc.Color(0.2, 0.2, 0.2, 0.5),
                useInput: true
            });
            
            // Add label to shop container
            const shopLabel = new pc.Entity('Shop Label');
            shopLabel.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.5, 0.5, 0.5),
                pivot: new pc.Vec2(0.5, 0.5),
                width: 200,
                height: 50,
                fontSize: 24,
                color: new pc.Color(1, 1, 1),
                text: '商店 (Shop)',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });

            shopContainer.addChild(shopLabel);
            uiRoot.addChild(shopContainer);
            
            const boardContainer = new pc.Entity('Board Container');
            boardContainer.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(0.5, 0.5, 0.5, 0.5),
                pivot: new pc.Vec2(0.5, 0.5),
                width: 800,
                height: 400,
                color: new pc.Color(0.3, 0.3, 0.3, 0.5),
                useInput: true
            });
            
            // Add label to board container
            const boardLabel = new pc.Entity('Board Label');
            boardLabel.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.5, 0.5, 0.5),
                pivot: new pc.Vec2(0.5, 0.5),
                width: 200,
                height: 50,
                fontSize: 24,
                color: new pc.Color(1, 1, 1),
                text: '棋盤 (Board)',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            boardContainer.addChild(boardLabel);
            uiRoot.addChild(boardContainer);
            
            const benchContainer = new pc.Entity('Bench Container');
            benchContainer.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(0.5, 1, 0.5, 1),
                pivot: new pc.Vec2(0.5, 1),
                width: 800,
                height: 150,
                margin: new pc.Vec4(0, 10, 0, 10),
                color: new pc.Color(0.2, 0.2, 0.2, 0.5),
                useInput: true
            });
            
            // Add label to bench container
            const benchLabel = new pc.Entity('Bench Label');
            benchLabel.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.5, 0.5, 0.5),
                pivot: new pc.Vec2(0.5, 0.5),
                width: 200,
                height: 50,
                fontSize: 24,
                color: new pc.Color(1, 1, 1),
                text: '板凳 (Bench)',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            benchContainer.addChild(benchLabel);
            uiRoot.addChild(benchContainer);
            
            const infoPanelContainer = new pc.Entity('Info Panel Container');
            infoPanelContainer.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(0, 0, 0, 1),
                pivot: new pc.Vec2(0, 0.5),
                width: 250,
                height: 600,
                margin: new pc.Vec4(10, 0, 0, 0),
                color: new pc.Color(0.2, 0.2, 0.4, 0.5),
                useInput: true
            });
            
            // Add label to info panel container
            const infoPanelLabel = new pc.Entity('Info Panel Label');
            infoPanelLabel.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.9, 0.5, 0.9),
                pivot: new pc.Vec2(0.5, 0.5),
                width: 200,
                height: 50,
                fontSize: 20,
                color: new pc.Color(1, 1, 1),
                text: '資訊面板 (Info Panel)',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            infoPanelContainer.addChild(infoPanelLabel);
            uiRoot.addChild(infoPanelContainer);
            
            const actionButtonContainer = new pc.Entity('Action Button Container');
            actionButtonContainer.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(1, 0, 1, 1),
                pivot: new pc.Vec2(1, 0.5),
                width: 250,
                height: 600,
                margin: new pc.Vec4(0, 0, 10, 0),
                color: new pc.Color(0.4, 0.2, 0.2, 0.5),
                useInput: true
            });
            
            // Add label to action button container
            const actionButtonLabel = new pc.Entity('Action Button Label');
            actionButtonLabel.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.9, 0.5, 0.9),
                pivot: new pc.Vec2(0.5, 0.5),
                width: 200,
                height: 50,
                fontSize: 20,
                color: new pc.Color(1, 1, 1),
                text: '動作按鈕 (Action Buttons)',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            actionButtonContainer.addChild(actionButtonLabel);
            uiRoot.addChild(actionButtonContainer);
            
            // Function to create templates with better visibility
            function createCardTemplate(name, width, height, color) {
                const template = new pc.Entity(name);
                template.addComponent('element', {
                    type: 'image',
                    width: width,
                    height: height,
                    color: color
                });
                
                // Add border to make the card more visible
                const border = new pc.Entity('Border');
                border.addComponent('element', {
                    type: 'image',
                    anchor: new pc.Vec4(0, 0, 1, 1),
                    pivot: new pc.Vec2(0.5, 0.5),
                    margin: new pc.Vec4(2, 2, 2, 2),
                    color: new pc.Color(1, 1, 1, 0.8)
                });
                template.addChild(border);
                
                // Add card background inside the border
                const background = new pc.Entity('Background');
                background.addComponent('element', {
                    type: 'image',
                    anchor: new pc.Vec4(0, 0, 1, 1),
                    pivot: new pc.Vec2(0.5, 0.5),
                    margin: new pc.Vec4(4, 4, 4, 4),
                    color: color
                });
                border.addChild(background);
                
                const nameText = new pc.Entity('NameText');
                nameText.addComponent('element', {
                    type: 'text',
                    width: width - 10,
                    height: 30,
                    anchor: new pc.Vec4(0.5, 0, 0.5, 0),
                    pivot: new pc.Vec2(0.5, 0),
                    fontSize: 16,
                    color: new pc.Color(1, 1, 1),
                    text: 'Chess Name',
                    fontAsset: fontAsset,
                    textAlign: 'center',
                    autoWidth: false,
                    autoHeight: false,
                    enabled: true
                });
                template.addChild(nameText);
                
                const levelText = new pc.Entity('LevelText');
                levelText.addComponent('element', {
                    type: 'text',
                    width: width - 10,
                    height: 20,
                    anchor: new pc.Vec4(1, 0, 1, 0),
                    pivot: new pc.Vec2(1, 0),
                    fontSize: 14,
                    color: new pc.Color(1, 1, 0),
                    text: '★1',
                    fontAsset: fontAsset,
                    textAlign: 'right',
                    autoWidth: false,
                    autoHeight: false,
                    enabled: true
                });
                template.addChild(levelText);
                
                return template;
            }
            
            // Create templates
            const shopCardTemplate = createCardTemplate('ShopCardTemplate', 120, 160, new pc.Color(0.3, 0.3, 0.3));
            shopCardTemplate.enabled = false;
            shopContainer.addChild(shopCardTemplate);
            
            const benchCardTemplate = createCardTemplate('BenchCardTemplate', 80, 120, new pc.Color(0.3, 0.3, 0.3));
            benchCardTemplate.enabled = false;
            benchContainer.addChild(benchCardTemplate);
            
            const boardCellTemplate = new pc.Entity('BoardCellTemplate');
            boardCellTemplate.addComponent('element', {
                type: 'image',
                width: 80,
                height: 80,
                color: new pc.Color(0.5, 0.5, 0.5)
            });
            
            // Add border to make the cell more visible
            const cellBorder = new pc.Entity('CellBorder');
            cellBorder.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(0, 0, 1, 1),
                pivot: new pc.Vec2(0.5, 0.5),
                margin: new pc.Vec4(1, 1, 1, 1),
                color: new pc.Color(0.8, 0.8, 0.8, 0.5)
            });
            boardCellTemplate.addChild(cellBorder);
            
            // Add cell coordinates text
            const cellCoordinates = new pc.Entity('CellCoordinates');
            cellCoordinates.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.5, 0.5, 0.5),
                pivot: new pc.Vec2(0.5, 0.5),
                fontSize: 12,
                color: new pc.Color(1, 1, 1, 0.7),
                text: 'X,Y',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            boardCellTemplate.addChild(cellCoordinates);
            
            boardCellTemplate.enabled = false;
            boardContainer.addChild(boardCellTemplate);
            
            const boardPieceTemplate = createCardTemplate('BoardPieceTemplate', 70, 70, new pc.Color(0.3, 0.6, 0.3));
            boardPieceTemplate.enabled = false;
            boardContainer.addChild(boardPieceTemplate);
            
            // Create UI components with visible elements
            
            // Create shop buttons and money text
            const refreshButton = new pc.Entity('RefreshButton');
            refreshButton.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(0.1, 0.2, 0.1, 0.2),
                pivot: new pc.Vec2(0.5, 0.5),
                width: 100,
                height: 40,
                color: new pc.Color(0.2, 0.6, 0.2, 0.8)
            });
            
            const refreshText = new pc.Entity('RefreshText');
            refreshText.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.5, 0.5, 0.5),
                pivot: new pc.Vec2(0.5, 0.5),
                fontSize: 16,
                color: new pc.Color(1, 1, 1),
                text: '刷新 (2G)',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            refreshButton.addChild(refreshText);
            shopContainer.addChild(refreshButton);
            
            const lockButton = new pc.Entity('LockButton');
            lockButton.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(0.9, 0.2, 0.9, 0.2),
                pivot: new pc.Vec2(0.5, 0.5),
                width: 100,
                height: 40,
                color: new pc.Color(0.6, 0.2, 0.2, 0.8)
            });
            
            const lockText = new pc.Entity('LockText');
            lockText.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.5, 0.5, 0.5),
                pivot: new pc.Vec2(0.5, 0.5),
                fontSize: 16,
                color: new pc.Color(1, 1, 1),
                text: '鎖定',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            lockButton.addChild(lockText);
            shopContainer.addChild(lockButton);
            
            const moneyText = new pc.Entity('MoneyText');
            moneyText.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.2, 0.5, 0.2),
                pivot: new pc.Vec2(0.5, 0.5),
                fontSize: 20,
                color: new pc.Color(1, 0.8, 0.2),
                text: '10G',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            shopContainer.addChild(moneyText);
            
            // Create sell zone for bench
            const sellZone = new pc.Entity('SellZone');
            sellZone.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(0.5, 0.3, 0.5, 0.3),
                pivot: new pc.Vec2(0.5, 0.5),
                width: 120,
                height: 40,
                color: new pc.Color(0.8, 0.2, 0.2, 0.6)
            });
            
            const sellZoneText = new pc.Entity('SellZoneText');
            sellZoneText.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.5, 0.5, 0.5),
                pivot: new pc.Vec2(0.5, 0.5),
                fontSize: 16,
                color: new pc.Color(1, 1, 1),
                text: '售出區域',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            sellZone.addChild(sellZoneText);
            benchContainer.addChild(sellZone);
            
            // Create buy XP button for action panel
            const buyXPButton = new pc.Entity('BuyXPButton');
            buyXPButton.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(0.5, 0.8, 0.5, 0.8),
                pivot: new pc.Vec2(0.5, 0.5),
                width: 150,
                height: 50,
                color: new pc.Color(0.2, 0.4, 0.8, 0.8)
            });
            
            const buyXPText = new pc.Entity('BuyXPText');
            buyXPText.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.5, 0.5, 0.5),
                pivot: new pc.Vec2(0.5, 0.5),
                fontSize: 18,
                color: new pc.Color(1, 1, 1),
                text: '購買 XP (4G)',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            buyXPButton.addChild(buyXPText);
            actionButtonContainer.addChild(buyXPButton);
            
            // Create XP progress bar
            const xpProgressBarBg = new pc.Entity('XPProgressBarBg');
            xpProgressBarBg.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(0.5, 0.7, 0.5, 0.7),
                pivot: new pc.Vec2(0.5, 0.5),
                width: 200,
                height: 20,
                color: new pc.Color(0.3, 0.3, 0.3, 0.8)
            });
            actionButtonContainer.addChild(xpProgressBarBg);
            
            const xpProgressBar = new pc.Entity('XPProgressBar');
            xpProgressBar.addComponent('element', {
                type: 'image',
                anchor: new pc.Vec4(0, 0, 0.5, 1),
                pivot: new pc.Vec2(0, 0.5),
                width: 100,
                height: 20,
                color: new pc.Color(0.2, 0.8, 0.2, 0.8)
            });
            xpProgressBarBg.addChild(xpProgressBar);
            
            const xpText = new pc.Entity('XPText');
            xpText.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.65, 0.5, 0.65),
                pivot: new pc.Vec2(0.5, 0.5),
                fontSize: 16,
                color: new pc.Color(1, 1, 1),
                text: 'XP: 2/6',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            actionButtonContainer.addChild(xpText);
            
            const levelText = new pc.Entity('LevelText');
            levelText.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.5, 0.6, 0.5, 0.6),
                pivot: new pc.Vec2(0.5, 0.5),
                fontSize: 20,
                color: new pc.Color(1, 0.8, 0.2),
                text: 'Level 3',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            actionButtonContainer.addChild(levelText);
            
            // Create UI components with script components
            const shopUI = new pc.Entity('ShopUI');
            shopUI.addComponent('script');
            shopUI.script.create('shopUI', {
                cardTemplate: shopCardTemplate,
                refreshButton: refreshButton,
                lockButton: lockButton,
                cardContainer: shopContainer,
                moneyText: moneyText
            });
            shopContainer.addChild(shopUI);
            
            const benchUI = new pc.Entity('BenchUI');
            benchUI.addComponent('script');
            benchUI.script.create('benchUI', {
                cardTemplate: benchCardTemplate,
                cardContainer: benchContainer,
                sellZone: sellZone,
                benchSize: 9
            });
            benchContainer.addChild(benchUI);
            
            const boardUI = new pc.Entity('BoardUI');
            boardUI.addComponent('script');
            boardUI.script.create('boardUI', {
                cellTemplate: boardCellTemplate,
                pieceTemplate: boardPieceTemplate,
                boardContainer: boardContainer,
                boardWidth: 8,
                boardHeight: 3,
                cellSize: 80
            });
            boardContainer.addChild(boardUI);
            
            // Create synergy template for info panel
            const synergyTemplate = new pc.Entity('SynergyTemplate');
            synergyTemplate.addComponent('element', {
                type: 'image',
                width: 200,
                height: 30,
                color: new pc.Color(0.3, 0.3, 0.6, 0.8)
            });
            
            const synergyNameText = new pc.Entity('NameText');
            synergyNameText.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0, 0, 0.7, 1),
                pivot: new pc.Vec2(0, 0.5),
                fontSize: 14,
                color: new pc.Color(1, 1, 1),
                text: '羈絆名稱',
                fontAsset: fontAsset,
                textAlign: 'left',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            synergyTemplate.addChild(synergyNameText);
            
            const synergyCountText = new pc.Entity('CountText');
            synergyCountText.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.7, 0, 0.85, 1),
                pivot: new pc.Vec2(0.5, 0.5),
                fontSize: 14,
                color: new pc.Color(1, 1, 0),
                text: '0',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            synergyTemplate.addChild(synergyCountText);
            
            const synergyBonusText = new pc.Entity('BonusText');
            synergyBonusText.addComponent('element', {
                type: 'text',
                anchor: new pc.Vec4(0.85, 0, 1, 1),
                pivot: new pc.Vec2(0.5, 0.5),
                fontSize: 14,
                color: new pc.Color(0, 1, 0),
                text: 'Lv0',
                fontAsset: fontAsset,
                textAlign: 'center',
                autoWidth: false,
                autoHeight: false,
                enabled: true
            });
            synergyTemplate.addChild(synergyBonusText);
            
            synergyTemplate.enabled = false;
            infoPanelContainer.addChild(synergyTemplate);
            
            // Create info panel UI
            const infoPanel = new pc.Entity('InfoPanel');
            infoPanel.addComponent('script');
            infoPanel.script.create('infoPanel', {
                moneyText: moneyText,
                levelText: levelText,
                xpText: xpText,
                synergiesContainer: infoPanelContainer,
                synergyTemplate: synergyTemplate
            });
            infoPanelContainer.addChild(infoPanel);
            
            // Create action button panel UI
            const actionButtonPanel = new pc.Entity('ActionButtonPanel');
            actionButtonPanel.addComponent('script');
            actionButtonPanel.script.create('actionButtonPanel', {
                buyXPButton: buyXPButton,
                xpProgressBar: xpProgressBar,
                xpText: xpText,
                levelText: levelText
            });
            actionButtonContainer.addChild(actionButtonPanel);
            });

            
            
            
            // Start the application
            app.start();
            
            // Hide loading screen
            document.getElementById('loading-screen').style.display = 'none';
        });
    </script>
</body>
</html>